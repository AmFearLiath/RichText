(function(a){a.fn.richText=function(t){function E(a,b){"undefined"===typeof b&&(b=null);x&&u();"heading"===a&&B()?y("<"+b+">"+B()+"</"+b+">"):document.execCommand(a,!1,b)}function B(){if(window.getSelection){var a=window.getSelection();return a.toString()}return document.selection.createRange?(a=document.selection.createRange(),a.text):!1}function y(a){if(window.getSelection){var b=window.getSelection();if(b.getRangeAt&&b.rangeCount){var c=b.getRangeAt(0);c.deleteContents();var d=document.createElement("div");
    d.innerHTML=a;a=document.createDocumentFragment();for(var g,f;g=d.firstChild;)f=a.appendChild(g);c.insertNode(a);f&&(c=c.cloneRange(),c.setStartAfter(f),c.collapse(!0),b.removeAllRanges(),b.addRange(c))}}else document.selection&&"Control"!==document.selection.type&&document.selection.createRange().pasteHTML(a)}function L(){p.find(".richText-editor").is(":visible")?(p.find(".richText-initial").show(),p.find(".richText-editor").hide(),a(".richText-toolbar").find(".richText-btn").each(function(){a(this).hasClass("fa-code")||
a(this).parent("li").attr("data-disable","true")})):(p.find(".richText-initial").hide(),p.find(".richText-editor").show(),a(".richText-toolbar").find("li").removeAttr("data-disable"))}var d=a.extend({bold:!0,italic:!0,underline:!0,leftAlign:!0,centerAlign:!0,rightAlign:!0,ol:!0,ul:!0,heading:!0,fontColor:!0,imageUpload:!0,fileUpload:!0,urls:!0,table:!0,removeStyles:!0,code:!0,colors:[],fileHTML:"",imageHTML:""},t),g=a(this);g.addClass("richText-initial");var p,f=a("<ul />"),l=a("<li />"),M=a("<a />",
    {"class":"richText-btn fa fa-bold","data-command":"bold"}),N=a("<a />",{"class":"richText-btn fa fa-italic","data-command":"italic"}),O=a("<a />",{"class":"richText-btn fa fa-underline","data-command":"underline"}),P=a("<a />",{"class":"richText-btn fa fa-align-left","data-command":"justifyLeft"}),Q=a("<a />",{"class":"richText-btn fa fa-align-center","data-command":"justifyCenter"}),R=a("<a />",{"class":"richText-btn fa fa-align-right","data-command":"justifyRight"}),S=a("<a />",{"class":"richText-btn fa fa-list-ol",
        "data-command":"insertOrderedList"}),T=a("<a />",{"class":"richText-btn fa fa-list","data-command":"insertUnorderedList"}),F=a("<a />",{"class":"richText-btn fa fa-header"}),G=a("<a />",{"class":"richText-btn fa fa-paint-brush"}),H=a("<a />",{"class":"richText-btn fa fa-image"}),I=a("<a />",{"class":"richText-btn fa fa-file-text-o"}),J=a("<a />",{"class":"richText-btn fa fa-link"}),K=a("<a />",{"class":"richText-btn fa fa-table"}),U=a("<a />",{"class":"richText-btn fa fa-recycle","data-command":"removeFormat"}),
    V=a("<a />",{"class":"richText-btn fa fa-code","data-command":"toggleCode"});t=a("<div />",{"class":"richText-dropdown-outer"});var k=a("<ul />",{"class":"richText-dropdown"}),v=a("<div />",{"class":"richText-dropdown"}),q=a("<div />",{"class":"richText-form"}),n=a("<div />",{"class":"richText-form-item"}),r=a("<label />"),w=a("<input />",{type:"text"});a("<input />",{type:"file"});var z=a("<select />"),A=a("<button />",{text:"Einf\u00fcgen","class":"btn"}),x,m="richText-"+Math.random().toString(36).substring(7),
    h=k.clone();h.append(a("<li />",{html:'<a data-command="formatBlock" data-option="h1">Title #1</a>'}));h.append(a("<li />",{html:'<a data-command="formatBlock" data-option="h2">Title #2</a>'}));h.append(a("<li />",{html:'<a data-command="formatBlock" data-option="h3">Title #3</a>'}));h.append(a("<li />",{html:'<a data-command="formatBlock" data-option="h4">Title #4</a>'}));F.append(t.clone().append(h));k=k.clone();k.html(function(a){var b=[],c="";b["#FFFFFF"]="White";b["#000000"]="Black";b["#7F6000"]=
    "Brown";b["#938953"]="Beige";b["#1F497D"]="Dark Blue";b.blue="Blue";b["#4F81BD"]="Light blue";b["#953734"]="Dark red";b.red="Red";b["#4F6128"]="Dark green";b.green="Green";b["#3F3151"]="Purple";b["#31859B"]="Dark Turquois";b["#4BACC6"]="Turquois";b["#E36C09"]="Dark orange";b["#F79646"]="Orange";b["#FFFF00"]="Yellow";d.colors&&0<d.colors.length&&(b=d.colors);for(var C in b)c+='<li class="inline"><a data-command="'+a+'" data-option="'+C+'" style="text-align:left;" title="'+b[C]+'"><span class="box-color" style="background-color:'+
    C+'"></span></a></li>';return c}("forecolor"));G.append(t.clone().append(k));k=v.clone();h=q.clone().attr("id","richText-URL").attr("data-editor",m);h.append(n.clone().append(r.clone().text("URL").attr("for","url")).append(w.clone().attr("id","url")));h.append(n.clone().append(r.clone().text("Text").attr("for","urlText")).append(w.clone().attr("id","urlText")));h.append(n.clone().append(r.clone().text("Open in").attr("for","openIn")).append(z.clone().attr("id","openIn").append(a("<option />",{value:"_self",
    text:"Same tab"})).append(a("<option />",{value:"_blank",text:"New tab"}))));h.append(n.clone().append(A.clone()));k.append(h);J.append(t.clone().append(k));k=v.clone();h=q.clone().attr("id","richText-Image").attr("data-editor",m);d.imageHTML&&(0<a(d.imageHTML).find("#imageURL").length||"imageURL"===a(d.imageHTML).attr("id"))?h.html(d.imageHTML):(h.append(n.clone().append(r.clone().text("Image URL").attr("for","imageURL")).append(w.clone().attr("id","imageURL"))),h.append(n.clone().append(r.clone().text("Align").attr("for",
    "align")).append(z.clone().attr("id","align").append(a("<option />",{value:"left",text:"Left"})).append(a("<option />",{value:"center",text:"Center"})).append(a("<option />",{value:"right",text:"Right"})))));h.append(n.clone().append(A.clone()));k.append(h);H.append(t.clone().append(k));z=v.clone();k=q.clone().attr("id","richText-File").attr("data-editor",m);d.fileHTML&&(0<a(d.fileHTML).find("#fileURL").length||"fileURL"===a(d.fileHTML).attr("id"))?k.html(d.fileHTML):(k.append(n.clone().append(r.clone().text("File URL").attr("for",
    "fileURL")).append(w.clone().attr("id","fileURL"))),k.append(n.clone().append(r.clone().text("Link text").attr("for","fileText")).append(w.clone().attr("id","fileText"))));k.append(n.clone().append(A.clone()));z.append(k);I.append(t.clone().append(z));v=v.clone();q=q.clone().attr("id","richText-Table").attr("data-editor",m);q.append(n.clone().append(r.clone().text("Rows").attr("for","tableRows")).append(w.clone().attr("id","tableRows").attr("type","number")));q.append(n.clone().append(r.clone().text("Columns").attr("for",
    "tableColumns")).append(w.clone().attr("id","tableColumns").attr("type","number")));q.append(n.clone().append(A.clone()));v.append(q);K.append(t.clone().append(v));(function(){var c="";if("TEXTAREA"!==g.prop("tagName")){if(g.val()){var b=g.val();var e=g.prop("attributes");a.each(e,function(){this.name&&(c+=" "+this.name+'="'+this.value+'"')});g.replaceWith(a("<textarea"+c+' data-richtext="init">'+b+"</textarea>"))}else g.html()?(b=g.html(),e=g.prop("attributes"),a.each(e,function(){this.name&&(c+=
    " "+this.name+'="'+this.value+'"')}),g.replaceWith(a("<textarea"+c+' data-richtext="init">'+b+"</textarea>"))):(e=g.prop("attributes"),a.each(e,function(){this.name&&(c+=" "+this.name+'="'+this.value+'"')}),g.replaceWith(a("<textarea"+c+' data-richtext="init"></textarea>')));g=a('[data-richtext="init"]');g.removeAttr("data-richtext")}p=a("<div />",{"class":"richText"});b=a("<div />",{"class":"richText-toolbar"});e=a("<div />",{"class":"richText-editor",id:m,contenteditable:!0});b.append(f);!0===d.bold&&
f.append(l.clone().append(M));!0===d.italic&&f.append(l.clone().append(N));!0===d.underline&&f.append(l.clone().append(O));!0===d.leftAlign&&f.append(l.clone().append(P));!0===d.centerAlign&&f.append(l.clone().append(Q));!0===d.rightAlign&&f.append(l.clone().append(R));!0===d.ol&&f.append(l.clone().append(S));!0===d.ul&&f.append(l.clone().append(T));!0===d.heading&&f.append(l.clone().append(F));!0===d.fontColor&&f.append(l.clone().append(G));!0===d.imageUpload&&f.append(l.clone().append(H));!0===
d.fileUpload&&f.append(l.clone().append(I));!0===d.urls&&f.append(l.clone().append(J));!0===d.table&&f.append(l.clone().append(K));!0===d.removeStyles&&f.append(l.clone().append(U));!0===d.code&&f.append(l.clone().append(V));e.html(g.val());p.append(b);p.append(e);p.append(g.clone().hide());g.replaceWith(p)})();a(document).on("keyup keydown change blur paste copy cut",".richText-editor",function(){var c=a("#"+m),b=c.html();c.siblings(".richText-initial").val(b);x=D()});a(document).on("keyup keydown blur paste copy cut",
    ".richText-initial",function(){var c=a("#"+m),b=c.siblings(".richText-initial").val();c.html(b);x=D()});a(document).on("click","#richText-URL button.btn",function(c){c.preventDefault();var b=a(this).parent(".richText-form-item").parent(".richText-form");if(b.attr("data-editor")===m){c=b.find("input#url").val();var e=b.find("input#urlText").val(),d=b.find("#openIn").val();d||(d="_self");e||(e=c);c?(c='<a href="'+c+'" target="'+d+'">'+e+"</a>",u(),y(c),b.find("input#url").val(""),b.find("input#urlText").val(""),
    a(".richText-toolbar li.is-selected").removeClass("is-selected")):(b.prepend(a("<div />",{style:"color:red;display:none;","class":"form-item is-error",text:"Please enter an URL"})),b.children(".form-item.is-error").slideDown(),setTimeout(function(){b.children(".form-item.is-error").slideUp(function(){a(this).remove()})},5E3))}});a(document).on("click","#richText-Image button.btn",function(c){c.preventDefault();var b=a(this).parent(".richText-form-item").parent(".richText-form");if(b.attr("data-editor")===
    m){c=b.find("#imageURL").val();var e=b.find("select#align").val();e||(e="center");if(c){var d="",d="center"===e?'<div style="text-align:center;"><img src="'+c+'"></div>':'<img src="'+c+'" align="'+e+'">';u();y(d);b.find("input#imageURL").val("");a(".richText-toolbar li.is-selected").removeClass("is-selected")}else b.prepend(a("<div />",{style:"color:red;display:none;","class":"form-item is-error",text:"Please select an image."})),b.children(".form-item.is-error").slideDown(),setTimeout(function(){b.children(".form-item.is-error").slideUp(function(){a(this).remove()})},
    5E3)}});a(document).on("click","#richText-File button.btn",function(c){c.preventDefault();var b=a(this).parent(".richText-form-item").parent(".richText-form");if(b.attr("data-editor")===m){c=b.find("#fileURL").val();var e=b.find("#fileText").val();e||(e=c);c?(c='<a href="'+c+'" target="_blank">'+e+"</a>",u(),y(c),b.find("input#fileURL").val(""),b.find("input#fileText").val(""),a(".richText-toolbar li.is-selected").removeClass("is-selected")):(b.prepend(a("<div />",{style:"color:red;display:none;",
    "class":"form-item is-error",text:"Please select a file."})),b.children(".form-item.is-error").slideDown(),setTimeout(function(){b.children(".form-item.is-error").slideUp(function(){a(this).remove()})},5E3))}});a(document).on("click","#richText-Table button.btn",function(c){c.preventDefault();c=a(this).parent(".richText-form-item").parent(".richText-form");if(c.attr("data-editor")===m){var b=c.find("input#tableRows").val(),e=c.find("input#tableColumns").val();if(!b||0>=b)b=2;if(!e||0>=e)e=2;for(var d=
    '<table class="table-1"><tbody>',f=1;f<=b;f++){for(var d=d+"<tr>",g=1;g<=e;g++)d+="<td> </td>";d+="</tr>"}d+="</tbod></table>";u();y(d);c.find("input#tableColumns").val("");c.find("input#tableRows").val("");a(".richText-toolbar li.is-selected").removeClass("is-selected")}});a(document).on("click",function(c){var b=a(c.target);0!==b.parents(".richText-toolbar").length&&(b.hasClass("richText-dropdown-outer")?b.parent("a").parent("li").removeClass("is-selected"):0<b.find(".richText").length?a(".richText-toolbar li").removeClass("is-selected"):
    b.hasClass("richText-btn")&&0<a(c.target).children(".richText-dropdown-outer").length&&(b.parent("li").addClass("is-selected"),b.hasClass("fa-link")?(u(),c=B(),b.find("input#urlText").val(""),b.find("input#url").val(""),c&&b.find("input#urlText").val(c)):b.hasClass("fa-image")))});a(document).on("click",".richText-toolbar a[data-command]",function(c){var b=a(this);0<b.closest(".richText-toolbar").siblings("#"+m).length&&(!b.parent("li").attr("data-disable")||"false"===b.parent("li").attr("data-disable"))&&
(c.preventDefault(),c=a(this).data("command"),"toggleCode"===c?L():(b=null,a(this).data("option")&&(b=a(this).data("option"),b.match(/^h[1-6]$/)&&(c="heading")),E(c,b),"removeFormat"===c&&E("formatBlock","div")))});if(window.getSelection&&document.createRange){var D=function(){var a=document.getElementById(m),b=window.getSelection&&window.getSelection();if(b&&0<b.rangeCount){var b=window.getSelection().getRangeAt(0),e=b.cloneRange();e.selectNodeContents(a);e.setEnd(b.startContainer,b.startOffset);
    a=e.toString().length;return{start:a,end:a+b.toString().length}}return{start:0,end:0}};var u=function(){var a=document.getElementById(m),b=x,e=0,d=document.createRange();d.setStart(a,0);d.collapse(!0);for(var a=[a],f,g=!1,k=!1;!k&&(f=a.pop());)if(3===f.nodeType){var h=e+f.length;!g&&b.start>=e&&b.start<=h&&(d.setStart(f,b.start-e),g=!0);g&&b.end>=e&&b.end<=h&&(d.setEnd(f,b.end-e),k=!0);e=h}else for(h=f.childNodes.length;h--;)a.push(f.childNodes[h]);b=window.getSelection();b.removeAllRanges();b.addRange(d)}}else document.selection&&
document.body.createTextRange&&(D=function(){var a=document.getElementById(m),b=document.selection.createRange(),d=document.body.createTextRange();d.moveToElementText(a);d.setEndPoint("EndToStart",b);a=d.text.length;return{start:a,end:a+b.text.length}},u=function(){var a=document.getElementById(m),b=x,d=document.body.createTextRange();d.moveToElementText(a);d.collapse(!0);d.moveEnd("character",b.end);d.moveStart("character",b.start);d.select()});return a(this)}})(jQuery);